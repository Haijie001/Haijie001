{"ast":null,"code":"var _jsxFileName = \"D:\\\\\\u6591\\u9A6C\\\\\\u524D\\u7AEFts\\\\\\u7535\\u5546\\u7F51\\u7AD9\\\\ecommerce-webapp\\\\src\\\\pages\\\\product\\\\product.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport { FakeStoreApi } from '../../services/fake-store-api';\nimport { useSearchParams } from \"react-router-dom\";\nimport { Item } from \"../../components/item\";\nimport { useCart } from \"../../context/cart\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Products = () => {\n  _s();\n\n  const [loading, setLoading] = useState(true);\n  const [products, setProducts] = useState([]);\n  const [query] = useSearchParams();\n  const {\n    addToCart\n  } = useCart();\n  const [sortOrder, setSortOrder] = useState({\n    key: 'price',\n    order: 'asc'\n  });\n  const searchQuery = query.get('q');\n  useEffect(() => {\n    const fetchProducts = async () => {\n      setLoading(true);\n      const fetchedProducts = searchQuery ? await FakeStoreApi.fetchProductsBySearchQuery(searchQuery) : await FakeStoreApi.fetchAllProducts();\n      setProducts(fetchedProducts);\n      setLoading(false);\n    };\n\n    fetchProducts().catch(console.error);\n  }, [searchQuery]); // 排序函数\n\n  const sortProducts = key => {\n    const order = sortOrder.key === key && sortOrder.order === 'asc' ? 'desc' : 'asc';\n    setSortOrder({\n      key,\n      order\n    });\n    const sortedProducts = [...products].sort((a, b) => {\n      if (order === 'asc') {\n        return a[key] < b[key] ? -1 : 1; // 升序\n      } else {\n        return a[key] > b[key] ? -1 : 1; // 降序\n      }\n    });\n    setProducts(sortedProducts);\n  }; // 在状态更新后进行排序\n\n\n  useEffect(() => {\n    if (products.length) {\n      const sortedProducts = [...products].sort((a, b) => {\n        if (sortOrder.order === 'asc') {\n          return a[sortOrder.key] < b[sortOrder.key] ? -1 : 1;\n        } else {\n          return a[sortOrder.key] > b[sortOrder.key] ? -1 : 1;\n        }\n      });\n      setProducts(sortedProducts);\n    }\n  }, [products, sortOrder]); // 仅依赖于 sortOrder\n\n  if (!loading && searchQuery && !products.length) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"product py-2\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"details p-3\",\n          children: \"No products found matching your query.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 13\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sortButtons\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => sortProducts('price'),\n        children: \"\\u6309\\u4EF7\\u683C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => sortProducts('rating'),\n        children: \"\\u6309\\u8BC4\\u4EF7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"products my-5\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid\",\n        children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loader\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 25\n        }, this) : products.map(product => /*#__PURE__*/_jsxDEV(Item, {\n          data: product,\n          addToCart: () => addToCart(product)\n        }, product.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Products, \"AZ2i52B0bca/D84vWLysRCNDejU=\", false, function () {\n  return [useSearchParams, useCart];\n});\n\n_c = Products;\nexport { Products };\n\nvar _c;\n\n$RefreshReg$(_c, \"Products\");","map":{"version":3,"names":["useEffect","useState","FakeStoreApi","useSearchParams","Item","useCart","Products","loading","setLoading","products","setProducts","query","addToCart","sortOrder","setSortOrder","key","order","searchQuery","get","fetchProducts","fetchedProducts","fetchProductsBySearchQuery","fetchAllProducts","catch","console","error","sortProducts","sortedProducts","sort","a","b","length","map","product","id"],"sources":["D:/斑马/前端ts/电商网站/ecommerce-webapp/src/pages/product/product.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { FakeStoreApi } from '../../services/fake-store-api';\nimport { useSearchParams } from \"react-router-dom\";\nimport { Item } from \"../../components/item\";\nimport { useCart } from \"../../context/cart\";\n\nconst Products = () => {\n    const [loading, setLoading] = useState(true);\n    const [products, setProducts] = useState([]);\n    const [query] = useSearchParams();\n    const { addToCart } = useCart();\n\n    const [sortOrder, setSortOrder] = useState({ key: 'price', order: 'asc' });\n\n    const searchQuery = query.get('q');\n\n    useEffect(() => {\n        const fetchProducts = async () => {\n            setLoading(true);\n            const fetchedProducts = searchQuery ? \n                await FakeStoreApi.fetchProductsBySearchQuery(searchQuery) : \n                await FakeStoreApi.fetchAllProducts();\n            setProducts(fetchedProducts);\n            setLoading(false);\n        }\n        fetchProducts().catch(console.error);\n    }, [searchQuery]);\n\n    // 排序函数\n    const sortProducts = (key) => {\n        const order = sortOrder.key === key && sortOrder.order === 'asc' ? 'desc' : 'asc';\n        setSortOrder({ key, order });\n\n        const sortedProducts = [...products].sort((a, b) => {\n            if (order === 'asc') {\n                return a[key] < b[key] ? -1 : 1; // 升序\n            } else {\n                return a[key] > b[key] ? -1 : 1; // 降序\n            }\n        });\n\n        setProducts(sortedProducts);\n    };\n\n    // 在状态更新后进行排序\n    useEffect(() => {\n        if (products.length) {\n            const sortedProducts = [...products].sort((a, b) => {\n                if (sortOrder.order === 'asc') {\n                    return a[sortOrder.key] < b[sortOrder.key] ? -1 : 1;\n                } else {\n                    return a[sortOrder.key] > b[sortOrder.key] ? -1 : 1;\n                }\n            });\n            setProducts(sortedProducts);\n        }\n    }, [products, sortOrder]); // 仅依赖于 sortOrder\n\n    if (!loading && searchQuery && !products.length) {\n        return (\n            <div className=\"container\">\n                <div className=\"product py-2\">\n                    <div className=\"details p-3\">No products found matching your query.</div>\n                </div>\n            </div>\n        )\n    }\n\n    return (\n        <div className=\"container\">\n            <div className=\"sortButtons\">\n                <button onClick={() => sortProducts('price')}>按价格</button>\n                <button onClick={() => sortProducts('rating')}>按评价</button>\n            </div>\n            <div className=\"products my-5\">\n                <div className=\"grid\">\n                    {loading ? (\n                        <div className=\"loader\" />\n                    ) : (\n                        products.map((product) => (\n                            <Item key={product.id} data={product} addToCart={() => addToCart(product)} />\n                        ))\n                    )}\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport { Products };"],"mappings":"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"},"metadata":{},"sourceType":"module"}